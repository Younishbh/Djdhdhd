<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NUVIA | Ø¹Ø§Ù„Ù… Ù…Ù† Ø§Ù„ÙØ®Ø§Ù…Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            /* Ø£Ù„ÙˆØ§Ù† Ù…ØªØ¯Ø±Ø¬Ø© ÙˆÙ…Ø±ÙŠØ­Ø© Ù„Ù„Ø¹ÙŠÙ† - Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† "Ø§Ù„Ø´ÙÙ‚ Ø§Ù„Ù„ÙŠÙ„ÙŠ" */
            --bg-gradient: linear-gradient(-45deg, #13111a, #1f1c2c, #2c2033, #0f0c14);
            
            /* Ø°Ù‡Ø¨ÙŠ Ù†Ø§Ø¹Ù… (Ø´Ø§Ù…Ø¨ÙŠÙ† / Ø±ÙˆØ² Ø¬ÙˆÙ„Ø¯) */
            --gold: #e0c3fc; 
            --gold-accent: #8ec5fc;
            --accent-gradient: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†ØµÙˆØµ */
            --text-light: #ececec;
            --text-dim: #b8b8b8;
            
            /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            --backdrop-blur: blur(12px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body { 
            background: var(--bg-gradient); 
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
            color: var(--text-light); 
            padding-bottom: 80px; 
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù…ÙˆØ¬Ø© */
        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- PRELOADER --- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f0c14; z-index: 9999;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 0.8s ease;
        }
        .loader-logo {
            font-family: 'Cinzel', serif; font-size: 3rem; 
            background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: pulse 2s infinite ease-in-out;
        }
        @keyframes pulse { 0%, 100% {opacity: 0.6; transform: scale(0.95);} 50% {opacity: 1; transform: scale(1.05);} }

        /* --- HEADER (Glassmorphism) --- */
        header {
            position: sticky; top: 0; z-index: 100;
            background: rgba(15, 12, 20, 0.7); 
            backdrop-filter: var(--backdrop-blur);
            -webkit-backdrop-filter: var(--backdrop-blur);
            padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--glass-border);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        .brand { font-family: 'Cinzel', serif; font-size: 1.8rem; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: 1px; font-weight: 700; }
        
        .cart-icon { position: relative; cursor: pointer; color: var(--text-light); font-size: 1.4rem; transition: 0.3s; }
        .cart-icon:hover { transform: scale(1.1); color: #fff; }
        .cart-count {
            position: absolute; top: -5px; right: -8px;
            background: var(--accent-gradient); color: #000; font-size: 0.7rem; font-weight: 900;
            width: 18px; height: 18px; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 10px rgba(142, 197, 252, 0.5);
        }

        /* --- HERO --- */
        .hero {
            height: 320px; position: relative;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; overflow: hidden;
        }
        /* ÙÙ‚Ø§Ø¹Ø§Øª Ø®Ù„ÙÙŠØ© Ù„Ù„Ø²ÙŠÙ†Ø© */
        .blob {
            position: absolute; width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(142, 197, 252, 0.15) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%; pointer-events: none; z-index: 0;
            animation: float 8s ease-in-out infinite;
        }
        .blob:nth-child(1) { top: -50px; left: -50px; animation-delay: 0s; }
        .blob:nth-child(2) { bottom: -50px; right: -50px; animation-delay: 4s; background: radial-gradient(circle, rgba(224, 195, 252, 0.15) 0%, rgba(0,0,0,0) 70%); }
        
        @keyframes float { 0% {transform: translate(0,0);} 50% {transform: translate(20px, 30px);} 100% {transform: translate(0,0);} }

        .hero h1 { font-family: 'Cinzel', serif; font-size: 3.2rem; color: #fff; margin-bottom: 10px; z-index: 2; text-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .hero p { color: var(--text-dim); letter-spacing: 4px; z-index: 2; text-transform: uppercase; font-size: 0.85rem; font-weight: 300; }

        /* --- CONTROLS --- */
        .controls-area {
            position: sticky; top: 70px; z-index: 90;
            background: transparent; padding: 10px 15px;
            pointer-events: none; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø¶ØºØ· Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„ÙØ§Ø±ØºØ© */
        }
        .controls-content {
            pointer-events: auto;
            background: rgba(20, 20, 30, 0.6);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }
        
        .search-box { position: relative; width: 100%; max-width: 600px; margin: 0 auto 15px auto; }
        .search-input {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            padding: 12px 40px 12px 20px; border-radius: 30px; color: #fff;
            transition: 0.3s; font-size: 0.95rem;
        }
        .search-input:focus { background: rgba(255,255,255,0.1); border-color: rgba(142, 197, 252, 0.3); box-shadow: 0 0 15px rgba(142, 197, 252, 0.1); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-dim); }

        .filters {
            display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px;
            scrollbar-width: none; justify-content: center;
        }
        .filters::-webkit-scrollbar { display: none; }
        
        .filter-btn {
            background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text-dim);
            padding: 8px 22px; border-radius: 25px; white-space: nowrap; cursor: pointer; transition: 0.4s;
            font-size: 0.9rem;
        }
        .filter-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .filter-btn.active { 
            background: var(--accent-gradient); 
            color: #000; border: none; font-weight: 600; 
            box-shadow: 0 4px 15px rgba(142, 197, 252, 0.3);
        }

        /* --- GRID --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .products-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 20px;
        }
        @media(min-width: 768px) { .products-grid { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; } }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .product-card {
            background: var(--glass-bg);
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            border: 1px solid var(--glass-border);
            border-radius: 20px; overflow: hidden; position: relative;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column;
            box-shadow: var(--glass-shadow);
        }
        .product-card:hover { 
            transform: translateY(-8px); 
            border-color: rgba(224, 195, 252, 0.3);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4); 
        }

        .card-img-wrap { position: relative; padding-top: 110%; overflow: hidden; cursor: pointer; }
        .card-img {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;
            transition: 0.8s ease; filter: brightness(0.9);
        }
        .product-card:hover .card-img { transform: scale(1.08); filter: brightness(1); }

        .badge {
            position: absolute; top: 12px; left: 12px;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); color: #fff; 
            padding: 4px 12px; font-size: 0.7rem; font-weight: 500; border-radius: 12px; z-index: 2;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card-info { padding: 18px; flex-grow: 1; display: flex; flex-direction: column; }
        .card-cat { color: var(--gold-accent); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 1px; }
        .card-title { font-size: 1.05rem; margin-bottom: 8px; font-weight: 500; color: #fff; line-height: 1.4; }
        .card-price { font-size: 1.15rem; font-weight: 700; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-top: auto; }
        
        .btn-add {
            width: 100%; padding: 12px; margin-top: 15px;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.05) 50%, transparent 100%);
            border: 1px solid var(--glass-border); color: #fff;
            border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: 500;
            display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.9rem;
        }
        .btn-add:hover { 
            background: var(--accent-gradient); 
            border-color: transparent; color: #000; 
            box-shadow: 0 5px 15px rgba(142, 197, 252, 0.2);
        }

        /* --- PRODUCT DETAIL MODAL --- */
        .product-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 2000;
            justify-content: center; align-items: center; padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

        .pm-content {
            background: #16151d; /* Ù„ÙˆÙ† ØµÙ„Ø¨ Ù‚Ù„ÙŠÙ„Ø§ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© */
            width: 100%; max-width: 850px;
            border-radius: 25px; overflow: hidden; display: flex; flex-direction: column;
            border: 1px solid rgba(255,255,255,0.1); position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        @media(min-width: 768px) { .pm-content { flex-direction: row; height: 500px; } }

        .pm-img-box { width: 100%; height: 300px; position: relative; overflow: hidden; }
        @media(min-width: 768px) { .pm-img-box { width: 45%; height: 100%; } }
        .pm-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        
        .pm-details { padding: 35px; width: 100%; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(135deg, rgba(255,255,255,0.02), transparent); }
        @media(min-width: 768px) { .pm-details { width: 55%; } }

        .close-pm { 
            position: absolute; top: 15px; left: 15px; color: #fff; font-size: 1.2rem; cursor: pointer; z-index: 10; 
            background: rgba(255,255,255,0.1); backdrop-filter: blur(5px);
            width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
            transition: 0.3s;
        }
        .close-pm:hover { background: #fff; color: #000; }

        /* --- CART MODAL --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(3px); z-index: 1000; justify-content: flex-end;
        }
        .modal-content {
            background: rgba(20, 20, 28, 0.95); width: 100%; max-width: 450px; height: 100%;
            padding: 30px; border-left: 1px solid rgba(255,255,255,0.1); overflow-y: auto;
            animation: slideLeft 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); display: flex; flex-direction: column;
            box-shadow: -10px 0 30px rgba(0,0,0,0.5);
        }
        @keyframes slideLeft { from {transform: translateX(100%); opacity: 0;} to {transform: translateX(0); opacity: 1;} }

        /* Form & Inputs */
        input, select {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: #fff;
            padding: 14px; border-radius: 12px; margin-top: 8px; font-size: 0.9rem;
            transition: 0.3s;
        }
        input:focus, select:focus { border-color: var(--gold-accent); background: rgba(255,255,255,0.08); }

        .gps-btn {
            background: rgba(142, 197, 252, 0.1); border: 1px dashed var(--gold-accent); color: var(--gold-accent);
            padding: 12px; border-radius: 12px; width: 100%; cursor: pointer; margin-top: 15px; font-weight: 500;
        }
        .whatsapp-btn {
            background: linear-gradient(135deg, #25D366, #128C7E); color: white;
            width: 100%; padding: 16px; border: none; border-radius: 15px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 25px;
            box-shadow: 0 8px 20px rgba(37, 211, 102, 0.25); transition: 0.3s;
        }
        .whatsapp-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(37, 211, 102, 0.35); }

        /* --- TOAST --- */
        #toast {
            visibility: hidden; min-width: 280px; 
            background: rgba(20, 20, 30, 0.9); backdrop-filter: blur(10px);
            color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed;
            z-index: 3000; left: 50%; bottom: 40px; transform: translateX(-50%);
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            font-size: 0.9rem;
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 40px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 40px; opacity: 1;} to {bottom: 0; opacity: 0;} }

    </style>
</head>
<body>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="preloader">
        <div class="loader-logo">NUVIA</div>
        <p style="color:rgba(255,255,255,0.5); margin-top:15px; letter-spacing:4px; font-size:0.8rem;">LOADING LUXURY</p>
    </div>

    <!-- Ø¥Ø´Ø¹Ø§Ø± Ù…Ù†Ø¨Ø«Ù‚ -->
    <div id="toast"><i class="fas fa-check-circle" style="color:var(--gold-accent); margin-left:5px;"></i> ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­</div>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
    <header>
        <div class="brand">NUVIA</div>
        <div class="cart-icon" onclick="openCart()">
            <i class="fas fa-shopping-bag"></i>
            <span class="cart-count" id="cart-count">0</span>
        </div>
    </header>

    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="hero">
        <div class="blob"></div>
        <div class="blob"></div>
        <h1>NUVIA</h1>
        <p>Ø¹Ø§Ù„Ù… Ù…Ù† Ø§Ù„ÙØ®Ø§Ù…Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ù„</p>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="controls-area">
        <div class="controls-content">
            <div class="search-box">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ø·Ø±Ùƒ Ø§Ù„Ù…ÙØ¶Ù„..." onkeyup="searchProducts()">
            </div>
            <div class="filters" id="filters-container">
                <button class="filter-btn active" onclick="filterProducts('all')">Ø§Ù„ÙƒÙ„</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="products-grid" id="products-container">
            <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù‡Ù†Ø§ -->
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ -->
    <div class="product-modal" id="productModal">
        <div class="pm-content">
            <div class="close-pm" onclick="closeProductModal()"><i class="fas fa-times"></i></div>
            <div class="pm-img-box">
                <img src="" id="pm-img" class="pm-img">
            </div>
            <div class="pm-details">
                <span id="pm-cat" style="color:var(--gold-accent); text-transform:uppercase; font-size:0.8rem; letter-spacing:1px; margin-bottom:10px; display:block;"></span>
                <h2 id="pm-title" style="font-family:'Cinzel'; margin-bottom:15px; font-size:2rem; line-height:1.2;"></h2>
                <p id="pm-desc" style="color:#aaa; line-height:1.7; margin-bottom:30px; font-weight:300;"></p>
                <div style="margin-top:auto">
                    <h3 id="pm-price" style="font-size:1.8rem; background:var(--accent-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-bottom:20px; font-weight:bold;"></h3>
                    <button class="whatsapp-btn" style="margin:0; background:linear-gradient(135deg, #e0c3fc, #8ec5fc); color:#000; box-shadow:0 8px 20px rgba(142, 197, 252, 0.3);" id="pm-add-btn">
                        Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© <i class="fas fa-plus" style="margin-right:5px;"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø³Ù„Ø© -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                <h2 style="font-family:'Cinzel'; color:var(--text-light); font-size:1.5rem;">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
                <span onclick="closeCart()" style="cursor:pointer; font-size:1.5rem; color:#888; transition:0.3s;" onmouseover="this.style.color='#fff'"><i class="fas fa-times"></i></span>
            </div>
            
            <div id="cart-items" style="flex-grow:1; overflow-y:auto; margin-bottom:20px; padding-right:5px;"></div>
            
            <div id="checkout-section" style="border-top:1px solid rgba(255,255,255,0.1); padding-top:25px;">
                <h4 style="color:#fff; margin-bottom:15px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h4>
                <input type="text" id="cust-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ±ÙŠÙ…">
                <select id="cust-gov" onchange="calculateTotal()">
                    <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©...</option>
                </select>
                <button type="button" class="gps-btn" onclick="getLocation()" id="gps-btn-el">
                    <i class="fas fa-map-marker-alt"></i> ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                </button>
                <input type="hidden" id="google-map-link">
                <input type="tel" id="cust-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

                <div style="background:rgba(255,255,255,0.03); padding:20px; border-radius:15px; margin-top:20px; border:1px solid rgba(255,255,255,0.05);">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px; color:#bbb; font-size:0.9rem;">
                        <span>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</span><span id="sub-total">0</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:15px; color:#bbb; font-size:0.9rem;">
                        <span>Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</span><span id="delivery-cost">0</span>
                    </div>
                    <div style="display:flex; justify-content:space-between; font-weight:bold; color:#fff; font-size:1.3rem; border-top:1px solid rgba(255,255,255,0.1); padding-top:15px;">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</span><span id="final-total" style="color:var(--gold-accent);">0</span>
                    </div>
                </div>

                <button class="whatsapp-btn" onclick="sendOrder()">
                    Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ <i class="fab fa-whatsapp"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ======================== Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ========================
        const PRODUCTS_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQdWOMb2scsi_GzqX-kFOhYGx4vTu-V2R4--h7A6hS1UbU_HyT58I5VQ6Ux3RvzynvjCdPLaO4h5NOg/pub?gid=0&single=true&output=csv';
        const SETTINGS_CSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQdWOMb2scsi_GzqX-kFOhYGx4vTu-V2R4--h7A6hS1UbU_HyT58I5VQ6Ux3RvzynvjCdPLaO4h5NOg/pub?gid=491751433&single=true&output=csv';
        // =========================================================

        let products = [];
        let filteredProducts = [];
        let cart = [];
        let deliveryRates = {}; 
        let storePhone = '';

        window.onload = async function() {
            setTimeout(() => {
                document.getElementById('preloader').style.opacity = '0';
                setTimeout(() => document.getElementById('preloader').style.display = 'none', 800);
            }, 1500);

            loadCartFromStorage();
            await loadAllData();
        };

        function saveCartToStorage() { localStorage.setItem('nuvia_cart', JSON.stringify(cart)); }
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem('nuvia_cart');
            if (savedCart) { cart = JSON.parse(savedCart); updateCartCount(); }
        }

        async function loadAllData() {
            try {
                const prodRes = await fetch(PRODUCTS_CSV);
                const prodText = await prodRes.text();
                products = mapProducts(parseCSV(prodText)); 
                filteredProducts = products;

                const setRes = await fetch(SETTINGS_CSV);
                const setText = await setRes.text();
                processSettings(parseCSV(setText));
                
                renderProducts(products);
                renderFilters();
            } catch (error) { console.error("Error:", error); }
        }

        function mapProducts(rawItems) {
            return rawItems.map(item => ({
                id: item['Ø§Ù„ØªØ³Ù„Ø³Ù„'],
                name: item['Ø§Ø³Ù…_Ø§Ù„Ù…Ù†ØªØ¬'],
                price: Number(item['Ø§Ù„Ø³Ø¹Ø±']),
                category: item['Ø§Ù„Ù‚Ø³Ù…'],
                image: item['Ø±Ø§Ø¨Ø·_Ø§Ù„ØµÙˆØ±Ø©'],
                description: item['Ø§Ù„ÙˆØµÙ']
            })).filter(item => item.name);
        }

        function processSettings(data) {
            const govSelect = document.getElementById('cust-gov');
            data.forEach(row => {
                const type = row['Ø§Ù„Ù†ÙˆØ¹'], key = row['Ø§Ù„Ø¨ÙŠØ§Ù†'], val = row['Ø§Ù„Ù‚ÙŠÙ…Ø©'];
                if(type === 'Ø¹Ø§Ù…' && key === 'ÙˆØ§ØªØ³Ø§Ø¨') storePhone = val;
                if(type === 'ØªÙˆØµÙŠÙ„') {
                    deliveryRates[key] = Number(val);
                    let opt = document.createElement('option');
                    opt.value = key; opt.textContent = key;
                    govSelect.appendChild(opt);
                }
            });
        }

        function renderProducts(items) {
            const container = document.getElementById('products-container');
            container.innerHTML = '';
            
            if(items.length === 0) {
                container.innerHTML = '<p style="grid-column:1/-1; text-align:center; padding:40px; color:#aaa; font-size:1.1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</p>';
                return;
            }

            items.forEach((p, index) => {
                const imgUrl = (p.image && p.image.length > 5) ? p.image : 'https://via.placeholder.com/400x400/222/888?text=NUVIA';
                const badge = (index % 4 === 0) ? '<span class="badge">Ù…Ù…ÙŠØ² âœ¨</span>' : ''; 

                container.innerHTML += `
                    <div class="product-card" style="animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; animation-delay:${index*80}ms; opacity:0; transform:translateY(30px);">
                        <div class="card-img-wrap" onclick="openProductModal('${p.id}')">
                            ${badge}
                            <img src="${imgUrl}" class="card-img" loading="lazy">
                        </div>
                        <div class="card-info">
                            <span class="card-cat">${p.category}</span>
                            <h3 class="card-title">${p.name}</h3>
                            <div class="card-price">${p.price.toLocaleString()} Ø¯.Ø¹</div>
                            <button class="btn-add" onclick="addToCart('${p.id}')">
                                Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }
        document.head.insertAdjacentHTML('beforeend', '<style>@keyframes fadeInUp { to {opacity:1; transform:translateY(0);} }</style>');

        function searchProducts() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const results = products.filter(p => p.name.toLowerCase().includes(query) || p.category.toLowerCase().includes(query));
            renderProducts(results);
        }

        function renderFilters() {
            const categories = ['all', ...new Set(products.map(p => p.category))];
            const container = document.getElementById('filters-container');
            container.innerHTML = '';
            categories.forEach(cat => {
                if(!cat) return;
                const btn = document.createElement('button');
                btn.className = cat === 'all' ? 'filter-btn active' : 'filter-btn';
                btn.textContent = cat === 'all' ? 'Ø§Ù„ÙƒÙ„' : cat;
                btn.onclick = (e) => filterProducts(cat, e);
                container.appendChild(btn);
            });
        }

        function filterProducts(cat, event) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if(event) event.target.classList.add('active');
            
            const list = cat === 'all' ? products : products.filter(p => p.category === cat);
            document.getElementById('search-input').value = ''; 
            renderProducts(list);
        }

        function openProductModal(id) {
            const p = products.find(x => x.id == id);
            if(!p) return;
            
            document.getElementById('pm-img').src = (p.image && p.image.length > 5) ? p.image : 'https://via.placeholder.com/400';
            document.getElementById('pm-cat').innerText = p.category;
            document.getElementById('pm-title').innerText = p.name;
            document.getElementById('pm-desc').innerText = p.description || 'ÙŠØªÙ…ÙŠØ² Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø·Ø± Ø¨ØªØ±ÙƒÙŠØ¨Ø© ÙØ±ÙŠØ¯Ø© ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø£ØµØ§Ù„Ø© Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª Ø§Ù„Ø´Ø±Ù‚ÙŠØ© ÙˆÙ„Ù…Ø³Ø§Øª Ø¹ØµØ±ÙŠØ© ÙØ§Ø®Ø±Ø©ØŒ Ù„ÙŠÙ…Ù†Ø­Ùƒ Ø­Ø¶ÙˆØ±Ø§Ù‹ Ù„Ø§ ÙŠÙÙ†Ø³Ù‰.';
            document.getElementById('pm-price').innerText = p.price.toLocaleString() + ' Ø¯.Ø¹';
            
            const btn = document.getElementById('pm-add-btn');
            btn.onclick = function() { addToCart(p.id); closeProductModal(); };
            
            document.getElementById('productModal').style.display = 'flex';
        }
        function closeProductModal() { document.getElementById('productModal').style.display = 'none'; }

        function addToCart(id) {
            const p = products.find(x => x.id == id);
            cart.push(p);
            saveCartToStorage();
            updateCartCount();
            showToast();
        }
        
        function showToast() {
            const x = document.getElementById("toast");
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        function updateCartCount() { document.getElementById('cart-count').innerText = cart.length; }
        
        function openCart() { 
            document.getElementById('cartModal').style.display = 'flex'; 
            renderCartItems(); calculateTotal(); 
        }
        function closeCart() { document.getElementById('cartModal').style.display = 'none'; }

        function renderCartItems() {
            const div = document.getElementById('cart-items');
            const checkoutSec = document.getElementById('checkout-section');
            div.innerHTML = '';
            
            if(cart.length === 0) {
                div.innerHTML = '<div style="text-align:center; padding:50px 20px; color:#666;"><i class="fas fa-shopping-basket" style="font-size:4rem; margin-bottom:15px; opacity:0.5;"></i><br>Ø³Ù„Ø© Ù…Ø´ØªØ±ÙŠØ§ØªÙƒ ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                checkoutSec.style.display = 'none'; return;
            }
            checkoutSec.style.display = 'block';
            
            cart.forEach((item, idx) => {
                div.innerHTML += `
                    <div style="background:rgba(255,255,255,0.03); padding:12px; border-radius:12px; margin-bottom:12px; display:flex; justify-content:space-between; align-items:center; border:1px solid rgba(255,255,255,0.05);">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <img src="${item.image}" style="width:55px; height:55px; object-fit:cover; border-radius:8px;">
                            <div>
                                <div style="font-weight:600; font-size:0.95rem; margin-bottom:4px;">${item.name}</div>
                                <div style="color:var(--gold-accent); font-size:0.85rem;">${item.price.toLocaleString()}</div>
                            </div>
                        </div>
                        <button onclick="removeFromCart(${idx})" style="color:#ff6b6b; background:rgba(255,107,107,0.1); width:35px; height:35px; border-radius:50%; border:none; cursor:pointer; display:flex; justify-content:center; align-items:center; transition:0.3s;"><i class="fas fa-trash-alt" style="font-size:0.9rem;"></i></button>
                    </div>
                `;
            });
        }

        function removeFromCart(idx) {
            cart.splice(idx,1); saveCartToStorage(); renderCartItems(); updateCartCount(); calculateTotal();
        }

        function calculateTotal() {
            let prodTotal = cart.reduce((sum, item) => sum + item.price, 0);
            const govName = document.getElementById('cust-gov').value;
            let delPrice = deliveryRates[govName] || 0;

            document.getElementById('sub-total').innerText = prodTotal.toLocaleString();
            document.getElementById('delivery-cost').innerText = delPrice.toLocaleString();
            document.getElementById('final-total').innerText = (prodTotal + delPrice).toLocaleString() + ' Ø¯.Ø¹';
            return { prodTotal, delPrice, finalTotal: prodTotal + delPrice };
        }

        function getLocation() {
            const btn = document.getElementById('gps-btn-el');
            const mapInput = document.getElementById('google-map-link');
            if (!navigator.geolocation) { alert("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù…"); return; }
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...';
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    mapInput.value = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                    btn.innerHTML = '<i class="fas fa-check"></i> ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù†Ø¬Ø§Ø­';
                    btn.style.background = "rgba(76, 175, 80, 0.1)";
                    btn.style.color = '#4CAF50'; btn.style.borderColor = '#4CAF50';
                },
                () => { btn.innerHTML = 'âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯'; }
            );
        }

        function sendOrder() {
            const name = document.getElementById('cust-name').value;
            const gov = document.getElementById('cust-gov').value;
            const phone = document.getElementById('cust-phone').value;
            const mapLink = document.getElementById('google-map-link').value;
            const totals = calculateTotal();

            if(!name || !gov || !phone) { alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©ØŒ Ø§Ù„Ù‡Ø§ØªÙ)"); return; }

            let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† NUVIA* ğŸ’\n\n`;
            msg += `ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\nğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${gov}\n`;
            if(mapLink) msg += `ğŸ—ºï¸ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${mapLink}\n`;
            
            msg += `\nğŸ›ï¸ *ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:*\n`;
            cart.forEach(item => msg += `â–«ï¸ ${item.name} - ${item.price.toLocaleString()}\n`);

            msg += `\nğŸ’µ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${totals.prodTotal.toLocaleString()}\n`;
            msg += `ğŸšš Ø§Ù„ØªÙˆØµÙŠÙ„: ${totals.delPrice.toLocaleString()}\n`;
            msg += `ğŸ’° *Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: ${totals.finalTotal.toLocaleString()} Ø¯.Ø¹*`;

            const targetPhone = storePhone || '9647700000000';
            window.open(`https://wa.me/${targetPhone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function parseCSV(text) {
            const lines = text.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const result = [];
            for(let i=1; i<lines.length; i++) {
                if(!lines[i].trim()) continue;
                const obj = {};
                const currentline = lines[i].split(',');
                for(let j=0; j<headers.length; j++) obj[headers[j]] = currentline[j] ? currentline[j].trim() : "";
                result.push(obj);
            }
            return result;
        }
    </script>
</body>
</html>
